* Move the DB Out

Production code thoughts.

* How it was done 
#+BEGIN_SRC clojure
(defn somefunctionC [] 
  (someDBfunctionAccess))

(defn somefunctionB []
  (othercalculation (somefunctionC)))

(defn somefunctionA []
  (somecalculation (somefunctionB)))

#+END_SRC

* Code smell?
#+BEGIN_SRC clojure
(deftest some-test 
  (with-redefs [functionA (fn [x] (dosomething x))
                functionB (fn [y] true)]
    #test_code))

#+END_SRC

* Changing the approach
#+BEGIN_SRC clojure
(defn somefunctionC [] 
  (someDBfunctionAccess))

(let [x (somefunctionC)]

  (defn somefunctionB [x]
    (somecalculation x))

  (defn somefunctionA [x]
    (somecalculation (somefunctionB x))))

#+END_SRC

* How it was done 2
#+BEGIN_SRC clojure
(let [a (someFunctionA)
      b (someFunctionB)]

  (somecall a)
  (let [c (someFunctionC)
        d (someFunctionD)]

  (caller b c d)))

#+END_SRC

* Code smell?

Lets upon Lets

* Changing the approach
#+BEGIN_SRC clojure
(-> (someNewFunctionA x)
    (someNewFunctionB)
    (someNewFunctionC)
    (someNewFunctionD)
    (caller))

#+END_SRC

* Next Steps?

Internalizing
